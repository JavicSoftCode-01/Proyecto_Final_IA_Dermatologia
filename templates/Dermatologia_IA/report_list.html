{#templates/Dermatologia_IA/report_list.html#}

{% block content %}
  <ul>
  <li><a href="{% url 'dermatology:upload_image' %}">Subir Imagen</a></li>
  <li><a href="{% url 'dermatology:report_list' %}">Mis Reportes de Análisis de Enfermedades</a></li>
</ul>
  <div class="container mt-4 mb-5">
    <div class="text-center mb-4">
      <h1 class="display-5 fw-bold text-primary">Mis Reportes de Análisis</h1>
      <div class="underline-custom"></div>
    </div>

    {% if reports %}
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4">
        {% for report in reports %}
          <div class="col">
            <div class="card card-report h-100">
              <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                  <span class="icon-circle me-2">
                    <i class="fas fa-microscope"></i>
                  </span>
                  <span class="report-label">Reporte ID {{ report.id }}</span>
                </div>

                <h5 class="card-title mb-2">{{ report.condition|default:"Sin condición" }}</h5>

                <!-- Patient information -->
                <div class="patient-info flex-grow-1">
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-user me-2"></i>Nombre:</span>
                    <span class="info-value">{{ report.first_name|default:"" }} {{ report.last_name|default:"" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-id-card me-2"></i>DNI:</span>
                    <span class="info-value">{{ report.dni|default:"No proporcionado" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-phone me-2"></i>Teléfono:</span>
                    <span class="info-value">{{ report.phone|default:"No proporcionado" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-envelope me-2"></i>Email:</span>
                    <span class="info-value">{{ report.email|default:"No proporcionado" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-user-clock me-2"></i>Edad:</span>
                    <span class="info-value">{{ report.age_approx|default:"Sin especificar" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-venus-mars me-2"></i>Sexo:</span>
                    <span class="info-value">{{ report.get_sex_display|default:"Sin especificar" }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="fas fa-map-marker-alt me-2"></i>Localización:</span>
                    <span class="info-value">{{ report.get_anatom_site_general_display|default:"Sin especificar" }}</span>
                  </div>
                </div>

                <!-- Action buttons -->
                <div class="mt-3">
                  <a href="{% url 'dermatology:report_detail' report.id %}" class="btn btn-action w-100 mb-2">
                    <i class="fas fa-eye me-2"></i>Ver Detalle
                  </a>
                  <a href="{% url 'dermatology:generate_report' report.id %}" class="btn btn-action w-100 mb-2">
                    <i class="fas fa-file-pdf me-2"></i>PDF
                  </a>
                  <button type="button" class="btn btn-action w-100 toggle-email-form" data-target="email-form-{{ report.id }}">
                    <i class="fas fa-envelope me-2"></i>Email
                  </button>
                  <div id="email-form-{{ report.id }}" class="email-form mt-2" style="display:none;">
                    <form action="{% url 'dermatology:send_report_email' image_id=report.id %}" method="post">
                      {% csrf_token %}
                      <div class="input-group">
                        <input type="email" name="email" class="form-control" placeholder="correo@dominio.com" required>
                        <button class="btn btn-send" type="submit"><i class="fas fa-paper-plane"></i></button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center empty-state mt-5">
        <i class="fas fa-folder-open empty-icon mb-3"></i>
        <h3 class="text-muted">No hay reportes disponibles</h3>
        <p>¡Comienza a analizar imágenes para ver tus resultados aquí!</p>
        <a href="{% url 'dermatology:upload_image' %}" class="btn btn-primary mt-2">
          <i class="fas fa-upload me-2"></i>Cargar nueva imagen
        </a>
      </div>
    {% endif %}
  </div>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.toggle-email-form').forEach(btn => {
        btn.addEventListener('click', () => {
          const form = document.getElementById(btn.dataset.target);
          form.style.display = form.style.display === 'block' ? 'none' : 'block';
        });
      });
    });
  </script>
{% endblock %}
