{% extends "components/base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
  <div class="container-fluid mt-4 mb-5 px-md-4">
    <div class="text-center mb-4">
      <h1 class="display-5 fw-bold text-primary">{{ header_title }}</h1>
      <div class="underline-custom"></div>
    </div>

    {% if reports %}
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4">
        {% for report in reports %}
          <div class="col">
            <div class="card card-report h-100">
              <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                <span class="icon-circle me-2">
                  <i class="{{ icon_classes.analysis }}"></i>
                </span>
                  <span class="report-label">{{ card_labels.report_id_prefix }} {{ report.id }}</span>
                </div>

                <h5 class="card-title mb-2">{{ report.condition|default:card_labels.default_condition|truncatewords:5 }}</h5>

                <div class="patient-info flex-grow-1">
                  <div class="info-row">
                    <span class="info-label"><i
                            class="{{ icon_classes.patient }} me-1"></i>{{ card_labels.patient_name }}</span>
                    <span class="info-value">{{ report.patient.first_name|default:"" }} {{ report.patient.last_name|default:""|truncatechars:15 }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i
                            class="{{ icon_classes.dni }} me-1"></i>{{ card_labels.patient_dni }}</span>
                    <span class="info-value">{{ report.patient.dni|default:card_labels.default_na }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i
                            class="{{ icon_classes.age }} me-1"></i>{{ card_labels.patient_age }}</span>
                    <span class="info-value">{{ report.patient.age_approx|default:card_labels.default_na }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i
                            class="{{ icon_classes.sex }} me-1"></i>{{ card_labels.patient_sex }}</span>
                    <span class="info-value">{{ report.patient.get_sex_display|default:card_labels.default_na }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i
                            class="{{ icon_classes.location }} me-1"></i>{{ card_labels.lesion_location }}</span>
                    <span class="info-value">{{ report.get_anatom_site_general_display|default:card_labels.default_na }}</span>
                  </div>
                  <div class="info-row">
                    <span class="info-label"><i class="{{ icon_classes.datetime }} me-1"></i>{{ card_labels.date_time }}</span>
                    <span class="info-value">{{ report.created_at|date:"d/m/Y H:i" }}</span>
                  </div>
                </div>

                <div class="mt-3 pt-3 border-top">
                  <a href="{% url 'dermatology:report_detail' report.id %}"
                     class="btn btn-sm btn-outline-primary w-100 mb-2">
                    <i class="{{ icon_classes.view_detail }} me-1"></i>{{ button_texts.view_detail }}
                  </a>
                  <a href="{% url 'dermatology:generate_report' image_id=report.id %}"
                     class="btn btn-sm btn-outline-danger w-100 mb-2">
                    <i class="{{ icon_classes.generate_pdf }} me-1"></i>{{ button_texts.generate_pdf }}
                  </a>
                  {% include "includes/sendEmail.html" with skin_image=report email_button_text=button_texts.send_email email_button_icon=icon_classes.send_email %}
                  <button
                          type="button"
                          class="btn btn-sm btn-outline-info w-100"
                          data-bs-toggle="modal"
                          data-bs-target="#emailModal{{ report.id }}">
                    <i class="{{ icon_classes.send_email }} me-1"></i> {{ button_texts.send_email }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {% if page_obj.has_other_pages %}
        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
              <li class="page-item"><a class="page-link" href="?page=1">{{ pagination_texts.first }}</a></li>
              <li class="page-item"><a class="page-link"
                                       href="?page={{ page_obj.previous_page_number }}">{{ pagination_texts.previous }}</a>
              </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active"><span class="page-link">{{ num }}</span></li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
              <li class="page-item"><a class="page-link"
                                       href="?page={{ page_obj.next_page_number }}">{{ pagination_texts.next }}</a></li>
              <li class="page-item"><a class="page-link"
                                       href="?page={{ page_obj.paginator.num_pages }}">{{ pagination_texts.last }}</a>
              </li>
            {% endif %}
          </ul>
        </nav>
      {% endif %}

    {% else %}
      <div class="text-center empty-state mt-5">
        <i class="{{ empty_state.icon_class }}"></i>
        <h3 class="text-muted">{{ empty_state.title }}</h3>
        <p>{{ empty_state.message }}</p> <br>
        <a href="{% url 'dermatology:upload_image' %}" class="btn btn-primary">
          <i class="{{ empty_state.upload_button_icon }} me-1"></i>{{ empty_state.upload_button_text }}
        </a>
      </div>
    {% endif %}
  </div>
{% endblock %}