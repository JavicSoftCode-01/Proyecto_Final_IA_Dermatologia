{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cambiar Contraseña - DermaIA</title>
  <link rel="stylesheet" href="{% static 'css/auth.css' %}"/>
  <link
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
          rel="stylesheet"
  />
</head>
<body>
<div class="auth-container">
  <div class="logo-panel">
    <div class="logo-container">
          <img src="{% static 'img/portada.png' %}" alt="DermaIA Logo" class="logo">

    </div>
  </div>
  <div class="auth-card">
    <!-- Mensajes -->
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
            <i class="fas fa-info-circle"></i>
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" class="auth-form">
      {% csrf_token %}
      <h2>Establecer una nueva contraseña</h2>
      <h3>
        Crea una nueva contraseña. Asegúrate de que sea diferente a las
        anteriores por seguridad.
      </h3>

      <div class="form-group">
        <label for="id_new_password1">Nueva contraseña</label>
        <input
                type="password"
                name="new_password1"
                id="id_new_password1"
                placeholder="Ingrese su nueva contraseña"
                required
        />
        {% if form.new_password1.errors %}
          <div class="error-message">{{ form.new_password1.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="id_new_password2">Confirmar nueva contraseña</label>
        <input
                type="password"
                name="new_password2"
                id="id_new_password2"
                placeholder="Confirme su nueva contraseña"
                required
        />
        {% if form.new_password2.errors %}
          <div class="error-message">{{ form.new_password2.errors.0 }}</div>
        {% endif %}
      </div>

      {% if form.non_field_errors %}
        <div class="error-message">
          {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
          {% endfor %}
        </div>
      {% endif %}

      <button type="submit" class="btn-auth">Actualizar contraseña</button>
    </form>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Agregar botones de cierre a las alertas
    document.querySelectorAll(".alert").forEach(function (alert) {
      // Solo agregar el botón si no existe ya
      if (!alert.querySelector(".close-btn")) {
        const closeBtn = document.createElement("button");
        closeBtn.className = "close-btn";
        closeBtn.innerHTML = "&times;";
        closeBtn.style.float = "right";
        closeBtn.style.background = "none";
        closeBtn.style.border = "none";
        closeBtn.style.fontSize = "1.2rem";
        closeBtn.style.cursor = "pointer";
        closeBtn.style.marginLeft = "10px";
        alert.insertBefore(closeBtn, alert.firstChild);

        closeBtn.addEventListener("click", function () {
          this.parentElement.style.display = "none";
        });
      }
    });

    // Autodesaparecer mensajes después de 5 segundos
    setTimeout(function () {
      document.querySelectorAll(".alert").forEach(function (alert) {
        alert.style.opacity = "0";
        alert.style.transition = "opacity 0.5s";
        setTimeout(function () {
          alert.style.display = "none";
        }, 500);
      });
    }, 5000);
  });
</script>
</body>
</html>
